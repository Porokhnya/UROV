#include "DelayedEvents.h"
#include "Buzzer.h"
//--------------------------------------------------------------------------------------------------------------------------------------
BuzzerClass Buzzer;
//--------------------------------------------------------------------------------------------------------------------------------------
BuzzerClass::BuzzerClass()
{
  active = false;
}
//--------------------------------------------------------------------------------------------------------------------------------------
void BuzzerClass::begin()
{
  pinMode(BUZZER_PIN,OUTPUT);
  digitalWrite(BUZZER_PIN,!BUZZER_LEVEL);

}
//--------------------------------------------------------------------------------------------------------------------------------------
void BuzzerClass::stop()
{
  buzzLevel(false);
}
//--------------------------------------------------------------------------------------------------------------------------------------
void BuzzerClass::buzz()
{
  if(active)
    return;

  active = true;
  buzzLevel(true);
    
  CoreDelayedEvent.raise(BUZZER_DURATION,buzzOffHandler,this);
}
//--------------------------------------------------------------------------------------------------------------------------------------
void BuzzerClass::buzzLevel(bool on)
{
  digitalWrite(BUZZER_PIN, on ? BUZZER_LEVEL : !BUZZER_LEVEL);
}
//--------------------------------------------------------------------------------------------------------------------------------------
void BuzzerClass::buzzOffHandler(void* param)
{
  BuzzerClass* bc = (BuzzerClass*) param;
  bc->buzzLevel(false);
  bc->active = false;
}
//--------------------------------------------------------------------------------------------------------------------------------------
